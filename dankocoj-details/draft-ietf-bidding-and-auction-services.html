<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Bidding and Auction Services</title>
<meta content="Daniel Kocoj" name="author">
<meta content='Benjamin "Russ" Hamilton' name="author">
<meta content="
       The Bidding and Auction Services provide a way for advertising auctions to execute in
remote environments while preserving user privacy. 
    " name="description">
<meta content="xml2rfc 3.23.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-bidding-and-auction-services-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.0
    Python 3.12.3
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.2.2
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-bidding-and-auction-services.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Bidding and Auction Services</td>
<td class="right">September 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Kocoj &amp; Hamilton</td>
<td class="center">Expires 21 March 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-bidding-and-auction-services-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-09-17" class="published">17 September 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-03-21">21 March 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Kocoj</div>
<div class="org">Google</div>
</div>
<div class="author">
      <div class="author-name">B. R. Hamilton</div>
<div class="org">Google</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Bidding and Auction Services</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The Bidding and Auction Services provide a way for advertising auctions to execute in
remote environments while preserving user privacy.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/privacysandbox/draft-ietf-protected-audience-auction-service">https://github.com/privacysandbox/draft-ietf-protected-audience-auction-service</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 21 March 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-scope" class="internal xref">Scope</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-message-format-specificatio" class="internal xref">Message Format Specifications</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-common-definitions" class="internal xref">Common Definitions</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-browser-to-bidding-and-auct" class="internal xref">Browser to Bidding and Auction Services</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="auto internal xref">2.2.1</a>.  <a href="#name-request-payload-data" class="internal xref">Request Payload Data</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="auto internal xref">2.2.2</a>.  <a href="#name-compression" class="internal xref">Compression</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="auto internal xref">2.2.3</a>.  <a href="#name-framing-and-padding" class="internal xref">Framing and Padding</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="auto internal xref">2.2.4</a>.  <a href="#name-encryption" class="internal xref">Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a href="#section-2.2.5" class="auto internal xref">2.2.5</a>.  <a href="#name-payload-optimization" class="internal xref">Payload Optimization</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-bidding-and-auction-service" class="internal xref">Bidding and Auction Services to Browser</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="auto internal xref">2.3.1</a>.  <a href="#name-decryption" class="internal xref">Decryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.2">
                    <p id="section-toc.1-1.2.2.3.2.2.1"><a href="#section-2.3.2" class="auto internal xref">2.3.2</a>.  <a href="#name-decompression" class="internal xref">Decompression</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.3">
                    <p id="section-toc.1-1.2.2.3.2.3.1"><a href="#section-2.3.3" class="auto internal xref">2.3.3</a>.  <a href="#name-response-payload-data" class="internal xref">Response Payload Data</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="problems">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Today, real-time bidding and ad auctions are executed on servers that may not
provide technical guarantees of security. Some users have concerns about how
their data is handled to generate relevant ads and in how that data is shared.
Protected Audience API (<a href="https://developer.android.com/design-for-safety/privacy-sandbox/fledge">Android</a>,
<a href="https://developer.chrome.com/docs/privacy-sandbox/fledge/">Chrome</a>) provides
ways to preserve privacy and limit third-party data sharing by serving
personalized ads based on previous mobile app or web engagement.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">For all platforms, Protected Audience may require <a href="https://github.com/privacysandbox/fledge-docs/blob/main/trusted_services_overview.md">real-time services</a>.
In the initial <a href="https://github.com/WICG/turtledove/blob/main/FLEDGE.md">proposal by Chrome</a>,
bidding and auction for Protected Audience ad demand is executed locally. This
can demand computation requirements that may be impractical to execute on
devices with limited processing power, or may be too slow to render ads due to
network latency.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This Bidding and Auction Services proposal outlines a way to allow Protected Audience
computation to take place on cloud servers,
rather than running locally on a user's device. Moving computations to
the cloud has the following benefits:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-4.1">
          <p id="section-1-4.1.1">Scalable auctions.<a href="#section-1-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.2">
          <p id="section-1-4.2.1">A scalable ad auction may include several buyers and sellers and that
can demand more compute resources and network bandwidth.<a href="#section-1-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.3">
          <p id="section-1-4.3.1">System health of the user's device.<a href="#section-1-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.4">
          <p id="section-1-4.4.1">Ensure better system health of the user's device by freeing up
computational cycles and network bandwidth.<a href="#section-1-4.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.5">
          <p id="section-1-4.5.1">Better latency of ad auctions.<a href="#section-1-4.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.6">
          <p id="section-1-4.6.1">Server to server communication on the cloud is faster than multiple device to server calls.<a href="#section-1-4.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.7">
          <p id="section-1-4.7.1">Adtech code can execute faster on servers with higher computing power compared to a device.<a href="#section-1-4.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.8">
          <p id="section-1-4.8.1">Servers have better processing power.<a href="#section-1-4.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-4.9">
          <p id="section-1-4.9.1">Adtechs can run more compute intensive workloads on a server compared to a device for better utility.<a href="#section-1-4.9.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-5">Standardized protocols for interacting with Bidding and Auction Services are
essential to creating a diverse and healthy ecosystem for such services.<a href="#section-1-5" class="pilcrow">¶</a></p>
<div id="Scope">
<section id="section-1.1">
        <h3 id="name-scope">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-scope" class="section-name selfRef">Scope</a>
        </h3>
<p id="section-1.1-1">This document provides a specification for the request and response message
format that a browser can use to communicate with remote services
that allows the browser to offload much of the work involved in running an advertisement
selection auction as part of the browser's implementation of the
Protected Audience API.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">This document does not describe distribution of private keys to the bidding
and auction services.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="format">
<section id="section-2">
      <h2 id="name-message-format-specificatio">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-message-format-specificatio" class="section-name selfRef">Message Format Specifications</a>
      </h2>
<div id="overview">
<section id="section-2.1">
        <h3 id="name-overview">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-2.1-1">To understand this document, it is important to know that the
communication between the browser and the remote servers uses a
request-response message exchange pattern. The request will first reach a seller server, after which
the seller will forward parts of the request to buyer servers. It is then up to the
seller server to gather buyer responses and form a final response for the browser. More detail
about the seller and buyer servers can be found in the <a href="https://github.com/privacysandbox/protected-auction-services-docs/blob/main/bidding_auction_services_system_design.md">server-side system design documentation</a>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<div id="common-definitions">
<section id="section-2.1.1">
          <h4 id="name-common-definitions">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-common-definitions" class="section-name selfRef">Common Definitions</a>
          </h4>
<p id="section-2.1.1-1"><a href="#format" class="auto internal xref">Section 2</a> makes frequent use of the following definitions.<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
            <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Term with CDDL Definition</th>
                <th class="text-left" rowspan="1" colspan="1">Detailed Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>json = tstr</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#JSON" class="cite xref">JSON</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>uuid = tstr .regexp "[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}"</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC9562" class="cite xref">RFC9562</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>origin = tstr .regexp "https://([^/:](:[0-9]+)?/"</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#ORIGIN" class="cite xref">ORIGIN</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>currency = tstr .size 3 .regexp /^[A-Z]{3}$/</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#ISO4217" class="cite xref">ISO4217</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>adRenderUrl = tstr</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#URL" class="cite xref">URL</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>adRenderId = tstr</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#ADRENDERID" class="cite xref">ADRENDERID</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>interestGroupOwner = origin</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">TODO</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
</section>
</div>
<div id="browser-to-services">
<section id="section-2.2">
        <h3 id="name-browser-to-bidding-and-auct">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-browser-to-bidding-and-auct" class="section-name selfRef">Browser to Bidding and Auction Services</a>
        </h3>
<p id="section-2.2-1">This section describes how the browser MUST form and serialize request messages
in order to communicate with the Bidding and Auction services.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">The required inputs to the steps in <a href="#browser-to-services" class="auto internal xref">Section 2.2</a> are:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2-3">
<li id="section-2.2-3.1">
            <p id="section-2.2-3.1.1">A data struct, as defined in <a href="#request-payload" class="auto internal xref">Section 2.2.1</a>.<a href="#section-2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.2-4">The outputs of the steps in <a href="#browser-to-services" class="auto internal xref">Section 2.2</a> will result in:<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2-5">
<li id="section-2.2-5.1">
            <p id="section-2.2-5.1.1">The HPKE context (<a href="#hpke-context" class="auto internal xref">Section 2.2.4.1</a>) used to encrypt the response and to be later used in <a href="#decryption" class="auto internal xref">Section 2.3.1</a>.<a href="#section-2.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.2-5.2">
            <p id="section-2.2-5.2.1">An encrypted bytestring (<a href="#encapsulation" class="auto internal xref">Section 2.2.4.2</a>) representing the request to be sent to the Bidding
and Auction Services.<a href="#section-2.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="request-payload">
<section id="section-2.2.1">
          <h4 id="name-request-payload-data">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-request-payload-data" class="section-name selfRef">Request Payload Data</a>
          </h4>
<p id="section-2.2.1-1">A request payload primarily consists of interest groups. A list of interest
group is represented by the following <span>[<a href="#CDDL" class="cite xref">CDDL</a>]</span>:<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-2.2.1-2">
<pre>
interestGroups = [ * interestGroup ]
interestGroup = {
  ; This interest group's name, see
  ; https://wicg.github.io/turtledove/#interest-group-name.
  name: tstr,

  ; Keys used to look up real-time bidding signals, see
  ; https://wicg.github.io/turtledove/#interest-group-trusted-bidding-signals-keys.
  ? biddingSignalsKeys: [* tstr],
  ; Data about the user that the bidder can use during bid calculation, see
  ; https://wicg.github.io/turtledove/#interest-group-user-bidding-signals.
  ? userBiddingSignals: json,
  ; Contains various ads that the interest group might show. See
  ; https://wicg.github.io/turtledove/#interest-group-ads.
  ? ads: [* adRenderId],

  ; Contains various ad components (or "products") that can be used to
  ; construct ads composed of multiple pieces — a top-level ad template
  ; "container" which includes some slots that can be filled in with
  ; specific "products". See
  ; https://wicg.github.io/turtledove/#interest-group-ad-components.
  ? components: [* adRenderId],
  ? browserSignals: {
    ; Number of times the group was joined in the last 30 days.
    ? joinCount: int,

    ; Number of times the group bid in an auction in the last 30
    ; days.
    ? bidCount: int,

    ; Tuple of time-ad pairs for a previous win for this interest
    ; group that occurred in the last 30 days.
    ; The time is specified in seconds before the containing
    ; auctionBlob was requested.
    ? prevWins: [* [int, adRenderId]],

    ; The most recent join time for this group expressed
    ; in milli seconds before the containing auctionBlob
    ; was requested. This field will be used by newer client
    ; versions. For older devices, the precison will be in seconds.
    ; If recencyMs is present, this value will be used to offer
    ; higher precision. If not, recency will be used. Only
    ; one of the recency or recencyMs is expected to present in
    ; the request.
    ? recencyMs: int
  }
}
</pre><a href="#section-2.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1-3">A list of interest groups for each owner MUST first be represented as <span>[<a href="#CBOR" class="cite xref">CBOR</a>]</span>,
and then the serialized list MUST be indiviudally compressed according to the
compression algorithm specified in the message framing (<a href="#request-framing" class="auto internal xref">Section 2.2.3</a>).
This compressed interest group data MUST then be aggregated into a map in the
complete request, which MUST be <span>[<a href="#CBOR" class="cite xref">CBOR</a>]</span> represented by the following <span>[<a href="#CDDL" class="cite xref">CDDL</a>]</span>:<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-2.2.1-4">
<pre>
request = {
  version: int,
  generationId: uuid,
  publisher: origin,
  interestGroups: {
    ; Map of interest group owner to CBOR encoded list of interest
    ; groups compressed using the method described in § Compression.
    * interestGroupOwner =&gt; bstr
  },
  ? enableDebugReporting: bool
}
</pre><a href="#section-2.2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1-5">The complete request MUST also be compressed using the same compression
algorithm as specified in the message framing (<a href="#request-framing" class="auto internal xref">Section 2.2.3</a>).<a href="#section-2.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-compression">
<section id="section-2.2.2">
          <h4 id="name-compression">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-compression" class="section-name selfRef">Compression</a>
          </h4>
<p id="section-2.2.2-1">The payload MAY undergo compression.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">The compression method's value in bits 4-0 in <a href="#request-framing" class="auto internal xref">Section 2.2.3</a>
corresponds to the below table:<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
            <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
              <tr>
                <th class="text-center" rowspan="1" colspan="1">Compression</th>
                <th class="text-left" rowspan="1" colspan="1">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">No Compression</td>
              </tr>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Brotli <span>[<a href="#RFC7932" class="cite xref">RFC7932</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">2</td>
                <td class="text-left" rowspan="1" colspan="1">GZIP <span>[<a href="#RFC1952" class="cite xref">RFC1952</a>]</span>
</td>
              </tr>
              <tr>
                <td class="text-center" rowspan="1" colspan="1">3-31</td>
                <td class="text-left" rowspan="1" colspan="1">Reserved</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
<div id="request-framing">
<section id="section-2.2.3">
          <h4 id="name-framing-and-padding">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-framing-and-padding" class="section-name selfRef">Framing and Padding</a>
          </h4>
<p id="section-2.2.3-1">The plaintext message has the following framing:<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
<table class="center" id="table-3">
            <caption><a href="#table-3" class="selfRef">Table 3</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Byte</th>
                <th class="text-left" rowspan="1" colspan="1">0</th>
                <th class="text-left" rowspan="1" colspan="1">0</th>
                <th class="text-left" rowspan="1" colspan="1">1 to 4</th>
                <th class="text-left" rowspan="1" colspan="1">5 to Size+4</th>
                <th class="text-left" rowspan="1" colspan="1">Size+5 to end</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Bits</td>
                <td class="text-left" rowspan="1" colspan="1">7-5</td>
                <td class="text-left" rowspan="1" colspan="1">4-0</td>
                <td class="text-left" rowspan="1" colspan="1">*</td>
                <td class="text-left" rowspan="1" colspan="1">*</td>
                <td class="text-left" rowspan="1" colspan="1">*</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Contents</td>
                <td class="text-left" rowspan="1" colspan="1">Version</td>
                <td class="text-left" rowspan="1" colspan="1">Compression</td>
                <td class="text-left" rowspan="1" colspan="1">Size</td>
                <td class="text-left" rowspan="1" colspan="1">Request Payload</td>
                <td class="text-left" rowspan="1" colspan="1">Padding</td>
              </tr>
            </tbody>
          </table>
<p id="section-2.2.3-3">where the the first 3 bits of the frame header specify the payload
version and the following 5 bits specify the compression algorithm.
The format described in this document corresponds to version 0.<a href="#section-2.2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.2.3-4">Messages MAY be zero padded so that the encrypted request is one of the
following bin sizes: 0KiB, 5KiB, 10KiB, 20KiB, 30KiB, 40KiB, 55KiB. An
implementation MAY need to remove some data from the payload to fit inside the
largest bucket.<a href="#section-2.2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.2.3-5">A compatible implementation processing requests SHOULD NOT rely on a specific
padding scheme for requests.<a href="#section-2.2.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encryption">
<section id="section-2.2.4">
          <h4 id="name-encryption">
<a href="#section-2.2.4" class="section-number selfRef">2.2.4. </a><a href="#name-encryption" class="section-name selfRef">Encryption</a>
          </h4>
<p id="section-2.2.4-1">After framing and padding the compressed payload, the entire plaintext message is
encrypted using <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> with the encapsulation performed similarly
to <a href="https://www.rfc-editor.org/rfc/rfc9458#section-4.3">Section 4.3</a> of <span>[<a href="#OHTTP" class="cite xref">OHTTP</a>]</span>.
Details on how to acquire <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> keys are out of scope for this document, however
we assume they will be provided by the browser as a <a href="https://www.rfc-editor.org/rfc/rfc9458#name-key-configuration">Key Configuration</a>
and are required inputs to the {#encapsulation} process.<a href="#section-2.2.4-1" class="pilcrow">¶</a></p>
<div id="hpke-context">
<section id="section-2.2.4.1">
            <h5 id="name-hpke-context">
<a href="#section-2.2.4.1" class="section-number selfRef">2.2.4.1. </a><a href="#name-hpke-context" class="section-name selfRef">HPKE Context</a>
            </h5>
<p id="section-2.2.4.1-1"><a href="https://www.rfc-editor.org/rfc/rfc9180.html#name-creating-the-encryption-con">Section 5.1</a>
of <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> describes how to create the Context required for encryption. This is
considered the 'sending' HPKE context, and the browser MUST store it for later
use when decrypting the response, as described in <a href="#decryption" class="auto internal xref">Section 2.3.1</a>.<a href="#section-2.2.4.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.4.1-2">The HPKE context struct is defined by the following <span>[<a href="#CDDL" class="cite xref">CDDL</a>]</span>:<a href="#section-2.2.4.1-2" class="pilcrow">¶</a></p>
<div class="lang-cddl sourcecode" id="section-2.2.4.1-3">
<pre>
hpke_context = {
   TODO
}
</pre><a href="#section-2.2.4.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="encapsulation">
<section id="section-2.2.4.2">
            <h5 id="name-encapsulation">
<a href="#section-2.2.4.2" class="section-number selfRef">2.2.4.2. </a><a href="#name-encapsulation" class="section-name selfRef">Encapsulation</a>
            </h5>
<p id="section-2.2.4.2-1">Instead of encapsulating Binary HTTP <span>[<a href="#BINARY" class="cite xref">BINARY</a>]</span> as per <a href="https://www.rfc-editor.org/rfc/rfc9458#section-4.3-4.1.1">Step 1 in OHTTP</a>,
the output from <a href="#request-framing" class="auto internal xref">Section 2.2.3</a> MUST be used as-is. This means that
we are repurposing the <span>[<a href="#OHTTP" class="cite xref">OHTTP</a>]</span> encapsulation mechanism, so <a href="https://www.rfc-editor.org/rfc/rfc9458.html#name-repurposing-the-encapsulati">we are required to
define new media types</a>:<a href="#section-2.2.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.4.2-2.1">
                <p id="section-2.2.4.2-2.1.1">The OHTTP request media type is “message/auction request”<a href="#section-2.2.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2.4.2-2.2">
                <p id="section-2.2.4.2-2.2.1">The OHTTP response media type is “message/auction response”<a href="#section-2.2.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
<p id="section-2.2.4.2-3">Note that these media types are <a href="https://www.rfc-editor.org/rfc/rfc9458.html#name-encapsulation-of-requests">concatenated with other fields when
creating the HPKE encryption context</a>,
and are not HTTP content or media types. In order to perform the encapsulation,
the steps in <a href="https://www.rfc-editor.org/rfc/rfc9458#section-4.3-3">the OHTTP encapsulation process</a>
MUST be followed precisely, except with an <code>info</code> equivalent to <code>message/auction request</code>.<a href="#section-2.2.4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="request-optimization">
<section id="section-2.2.5">
          <h4 id="name-payload-optimization">
<a href="#section-2.2.5" class="section-number selfRef">2.2.5. </a><a href="#name-payload-optimization" class="section-name selfRef">Payload Optimization</a>
          </h4>
<p id="section-2.2.5-1">A compatible implementation MAY support control over how interest groups are
serialized into a request and the size of the request. An example implementation
for this feature is as follows:<a href="#section-2.2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.2.5-2">This algorithm takes as input all of the <code>relevant interest groups</code>, an optional
<code>desired total size</code>, and an optional list of <code>interest group owners</code> to include
each with an optional <code>desired size</code>.<a href="#section-2.2.5-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3">
<li id="section-2.2.5-3.1">
              <p id="section-2.2.5-3.1.1">If <code>desired total size</code> is not specified, but the list of <code>interest group owners</code>
includes at least one entry with a specified <code>desired size</code>:<a href="#section-2.2.5-3.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.1.2">
<li id="section-2.2.5-3.1.2.1">
                  <p id="section-2.2.5-3.1.2.1.1">Set <code>desired total size</code> to the sum of all specified <code>desired size</code> in the
list of <code>interest group owners</code>.<a href="#section-2.2.5-3.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              </ol>
</li>
            <li id="section-2.2.5-3.2">
              <p id="section-2.2.5-3.2.1">Group the list of <code>relevant interest groups</code> by owner into a map of from
interest group owner to a list of interest groups sorted by decreasing
priority, <code>interest group map</code>.<a href="#section-2.2.5-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.3">
              <p id="section-2.2.5-3.3.1">If the list of <code>interest group owners</code> is specified, remove interest groups
whose owner is not on the list.<a href="#section-2.2.5-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.4">
              <p id="section-2.2.5-3.4.1">Construct a request, <code>request</code>, as normal only with the value of the
<code>interestGroups</code> field for each interest group owner as
zero length.<a href="#section-2.2.5-3.4.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.5">
              <p id="section-2.2.5-3.5.1">Set <code>current_size</code> to be the serialized size of the encrypted request
created from <code>request</code> without padding.<a href="#section-2.2.5-3.5.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.6">
              <p id="section-2.2.5-3.6.1">Set <code>remaining_allocated_size</code> to 0.<a href="#section-2.2.5-3.6.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.7">
              <p id="section-2.2.5-3.7.1">Set <code>remaining_unsized_owners</code> to 0.<a href="#section-2.2.5-3.7.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.8">
              <p id="section-2.2.5-3.8.1">For each <code>interest group owner</code>, <code>interest group list</code> in
<code>interest group map</code>:<a href="#section-2.2.5-3.8.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.8.2">
<li id="section-2.2.5-3.8.2.1">
                  <p id="section-2.2.5-3.8.2.1.1">If there is a <code>desired size</code> for <code>interest group owner</code>:<a href="#section-2.2.5-3.8.2.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.8.2.1.2">
<li id="section-2.2.5-3.8.2.1.2.1">
                      <p id="section-2.2.5-3.8.2.1.2.1.1">Increment <code>remaining_allocated_size</code> by <code>desired size</code>.<a href="#section-2.2.5-3.8.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  </ol>
</li>
                <li id="section-2.2.5-3.8.2.2">
                  <p id="section-2.2.5-3.8.2.2.1">Otherwise<a href="#section-2.2.5-3.8.2.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.8.2.2.2">
<li id="section-2.2.5-3.8.2.2.2.1">
                      <p id="section-2.2.5-3.8.2.2.2.1.1">Increment <code>remaining_unsized_owners</code> by 1.<a href="#section-2.2.5-3.8.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  </ol>
</li>
              </ol>
</li>
            <li id="section-2.2.5-3.9">
              <p id="section-2.2.5-3.9.1">For each <code>interest group owner</code>, <code>interest group list</code> in
<code>interest group map</code> where there is a <code>desired size</code> specified for
<code>interest group owner</code>:<a href="#section-2.2.5-3.9.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.9.2">
<li id="section-2.2.5-3.9.2.1">
                  <p id="section-2.2.5-3.9.2.1.1">If the number of <code>unsized_owners</code> is not 0:<a href="#section-2.2.5-3.9.2.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.9.2.1.2">
<li id="section-2.2.5-3.9.2.1.2.1">
                      <p id="section-2.2.5-3.9.2.1.2.1.1">Set the <code>allowed_interest_group_size</code> to the <code>desired size</code> for this
<code>interest group owner</code>. This is a fixed size allocation.<a href="#section-2.2.5-3.9.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                  </ol>
</li>
                <li id="section-2.2.5-3.9.2.2">
                  <p id="section-2.2.5-3.9.2.2.1">Otherwise:<a href="#section-2.2.5-3.9.2.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.9.2.2.2">
<li id="section-2.2.5-3.9.2.2.2.1">
                      <p id="section-2.2.5-3.9.2.2.2.1.1">Let <code>remaining_size</code> be equal to the <code>desired total size</code>-<code>current_size</code>.<a href="#section-2.2.5-3.9.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                    <li id="section-2.2.5-3.9.2.2.2.2">
                      <p id="section-2.2.5-3.9.2.2.2.2.1">Set the <code>allowed_interest_group_size</code> to
<code>remaining_size</code>*<code>desired_size</code>/<code>remaining_allocated_size</code>. This is a
proportional allocation.<a href="#section-2.2.5-3.9.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  </ol>
</li>
                <li id="section-2.2.5-3.9.2.3">
                  <p id="section-2.2.5-3.9.2.3.1">Set <code>remaining_allocated_size</code> = <code>remaining_allocated_size</code>-<code>current_size</code>.<a href="#section-2.2.5-3.9.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.9.2.4">
                  <p id="section-2.2.5-3.9.2.4.1">Serialize the <code>interest group list</code> into <code>serialized_group</code>.<a href="#section-2.2.5-3.9.2.4.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.9.2.5">
                  <p id="section-2.2.5-3.9.2.5.1">If adding the <code>serialized_group</code> to <code>request</code> would make it more than
<code>allowed_interest_group_size</code> larger than the current size, then remove
the lowest priority interest group and repeat from the previous step.<a href="#section-2.2.5-3.9.2.5.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.9.2.6">
                  <p id="section-2.2.5-3.9.2.6.1">Set <code>request["interestGroups"][interest group owner]</code> to
<code>serialized_group</code>.<a href="#section-2.2.5-3.9.2.6.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.9.2.7">
                  <p id="section-2.2.5-3.9.2.7.1">Set <code>current_size</code> to be the serialized size of the encrypted request
created from <code>request</code> without padding.<a href="#section-2.2.5-3.9.2.7.1" class="pilcrow">¶</a></p>
</li>
              </ol>
</li>
            <li id="section-2.2.5-3.10">
              <p id="section-2.2.5-3.10.1">For each <code>interest group owner</code>, <code>interest group list</code> in
<code>interest group map</code> where there is not <code>desired size</code> specified for
<code>interest group owner</code>:<a href="#section-2.2.5-3.10.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.5-3.10.2">
<li id="section-2.2.5-3.10.2.1">
                  <p id="section-2.2.5-3.10.2.1.1">Let <code>remaining_size</code> be equal to the <code>desired total size</code>-<code>current_size</code>.<a href="#section-2.2.5-3.10.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.10.2.2">
                  <p id="section-2.2.5-3.10.2.2.1">Set the <code>allowed_interest_group_size</code> to
<code>remaining_size</code>*/<code>remaining_unsized_owners</code>. This is a
equal size allocation.<a href="#section-2.2.5-3.10.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.10.2.3">
                  <p id="section-2.2.5-3.10.2.3.1">Decrement <code>remaining_unsized_owners</code> by 1.<a href="#section-2.2.5-3.10.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.10.2.4">
                  <p id="section-2.2.5-3.10.2.4.1">Serialize the <code>interest group list</code> into <code>serialized_group</code>.<a href="#section-2.2.5-3.10.2.4.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.10.2.5">
                  <p id="section-2.2.5-3.10.2.5.1">If adding the <code>serialized_group</code> to <code>request</code> would make it more than
<code>allowed_interest_group_size</code> larger than the current size, then remove
the lowest priority interest group and repeat from the previous step.<a href="#section-2.2.5-3.10.2.5.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.10.2.6">
                  <p id="section-2.2.5-3.10.2.6.1">Set <code>request["interestGroups"][interest group owner]</code> to
<code>serialized_group</code>.<a href="#section-2.2.5-3.10.2.6.1" class="pilcrow">¶</a></p>
</li>
                <li id="section-2.2.5-3.10.2.7">
                  <p id="section-2.2.5-3.10.2.7.1">Set <code>current_size</code> to be the serialized size of the encrypted request
created from <code>request</code> without padding.<a href="#section-2.2.5-3.10.2.7.1" class="pilcrow">¶</a></p>
</li>
              </ol>
</li>
            <li id="section-2.2.5-3.11">
              <p id="section-2.2.5-3.11.1">If there are no interest groups in the request, discard the <code>request</code> and
return an empty byte array.<a href="#section-2.2.5-3.11.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.12">
              <p id="section-2.2.5-3.12.1">Frame <code>request</code> as in <a href="#request-framing" class="auto internal xref">Section 2.2.3</a> and zero pad up to <code>desired total size</code>.<a href="#section-2.2.5-3.12.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.5-3.13">
              <p id="section-2.2.5-3.13.1">Return the encrypted result (as in <a href="#encryption" class="auto internal xref">Section 2.2.4</a>).<a href="#section-2.2.5-3.13.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
</section>
</div>
<div id="services-to-browser">
<section id="section-2.3">
        <h3 id="name-bidding-and-auction-service">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-bidding-and-auction-service" class="section-name selfRef">Bidding and Auction Services to Browser</a>
        </h3>
<p id="section-2.3-1">This section describes how the browser MUST deserialize response messages from
the Bidding and Auction Services. The steps MUST be performed in the following
order: decryption (<a href="#decryption" class="auto internal xref">Section 2.3.1</a>), decompression (<a href="#decompression" class="auto internal xref">Section 2.3.2</a>), and
finally parsing the response payload as in <a href="#response-payload" class="auto internal xref">Section 2.3.3</a>.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">The required inputs from the browser to the steps in {#services-to-browser}:<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3-3">
<li id="section-2.3-3.1">
            <p id="section-2.3-3.1.1">The encrypted repsonse bytestring.<a href="#section-2.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.3-3.2">
            <p id="section-2.3-3.2.1">The HPKE context created in <a href="#hpke-context" class="auto internal xref">Section 2.2.4.1</a>.<a href="#section-2.3-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.3-4">The resulting output for the browser is:<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3-5">
<li id="section-2.3-5.1">
            <p id="section-2.3-5.1.1">The decoded response data structure, as described in <a href="#response-payload" class="auto internal xref">Section 2.3.3</a>.<a href="#section-2.3-5.1.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="decryption">
<section id="section-2.3.1">
          <h4 id="name-decryption">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-decryption" class="section-name selfRef">Decryption</a>
          </h4>
<p id="section-2.3.1-1">The response message is encrypted using HPKE with the encapsulation performed
according to <a href="https://www.rfc-editor.org/rfc/rfc9458.html#name-encapsulation-of-responses">Section 4.4</a>
of <span>[<a href="#OHTTP" class="cite xref">OHTTP</a>]</span> as the response to the request message.<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<p id="section-2.3.1-2">The browser MUST decrypt the response by following the standard <span>[<a href="#OHTTP" class="cite xref">OHTTP</a>]</span> <a href="https://www.rfc-editor.org/rfc/rfc9458#section-4.4-5">Encapsulated Response
decryption procedure</a>. The
HPKE context used for decryption MUST be precisely the same context that was
created in <a href="#hpke-context" class="auto internal xref">Section 2.2.4.1</a>, and should be provided by the browser in addition to
the response bytestring.<a href="#section-2.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="decompression">
<section id="section-2.3.2">
          <h4 id="name-decompression">
<a href="#section-2.3.2" class="section-number selfRef">2.3.2. </a><a href="#name-decompression" class="section-name selfRef">Decompression</a>
          </h4>
<p id="section-2.3.2-1">The message framing is exactly as in <a href="#request-framing" class="auto internal xref">Section 2.2.3</a>, but the entire
response payload is compressed. Starting with Byte 0, read bits 4-0 and use
the chart in <a href="#request-compression" class="auto internal xref">Section 2.2.2</a> to decode which decompression algorithm
MUST be applied to the response payload.<a href="#section-2.3.2-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2-2">The output of the decompression process will be a payload equivalent to the
<a href="https://wicg.github.io/turtledove/#server-auction-response">auction server response struct</a>,
as further described in <a href="#response-payload" class="auto internal xref">Section 2.3.3</a>.<a href="#section-2.3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="response-payload">
<section id="section-2.3.3">
          <h4 id="name-response-payload-data">
<a href="#section-2.3.3" class="section-number selfRef">2.3.3. </a><a href="#name-response-payload-data" class="section-name selfRef">Response Payload Data</a>
          </h4>
<p id="section-2.3.3-1">The response has the following data, serialized as <span>[<a href="#CBOR" class="cite xref">CBOR</a>]</span> and matching
the following shape (described via <span>[<a href="#CDDL" class="cite xref">CDDL</a>]</span>):<a href="#section-2.3.3-1" class="pilcrow">¶</a></p>
<div class="breakable lang-cddl sourcecode" id="section-2.3.3-2">
<pre>
response = {
  ; The ad to render.
  adRenderURL: adRenderUrl,

  ; List of URLs for component ads displayed as part of this
  ; ad.
  ? components: [* adRenderUrl],

  ; Name of the interest group to which the ad belongs.
  ; See https://wicg.github.io/turtledove/#interest-group-name.
  ? interestGroupName: tstr,

  ; Origin of the Buyer who owns the interest group.
  ; The original request for this response MUST contain this
  ; interestGroupOwner, which additionally MUST provide an interest
  ; group with interestGroupName.
  ? interestGroupOwner: interestGroupOwner,

  ; Indices of interest groups in the original request for this owner
  ; that submitted a bid.
  ? biddingGroups: {
    * interestGroupOwner =&gt; [* int]
  },

  ; Specifies which interest groups are eligible for an update on the
  ; client.
  ? updateGroups: {
    * interestGroupOwner =&gt; [* {
      ; Index of interest group in the original request for interestGroupOwner.
      index: int
      ; Browser should update the interest group represented by 'index'
      ; if its on-device last updated time is gerather than this.
      updateIfOlderThanMs: int
    }]
  },

  ; Score of the ad determined during the auction.
  ; Any value that is zero or negative indicates that the ad cannot
  ; win the auction.
  ; The winner of the auction would be the ad that was given the
  ; highest score.
  ? score: float,

  ; Bid price corresponding to an ad
  ? bid: float,

  ; Optional currency of the bid.
  ? bidCurrency: currency,

  ; Optional BuyerReportingId of the winning Ad
  ? buyerReportingId: tstr,

  ; Optional BuyerAndSellerReportingId of the winning Ad
  ? buyerAndSellerReportingId: tstr,

  ; The auction result may be ignored if set to true.
  ? isChaff: bool,

  ? winReportingUrls: {
    ? buyerReportingUrls: reportingUrls,
    ? componentSellerReportingUrls: reportingUrls,
    ? topLevelSellerReportingUrls: reportingUrls
  },

  ? error: {
    code: int,
    message: tstr
  },

  ; Arbitrary metadata to pass to the top-level seller
  ? adMetadata: json,

  ; Optional name/domain for the top-level seller in case this is a
  ; component auction.
  ? topLevelSeller: origin,

}

; Defines the structure for reporting URLs.
reportingUrls = {
  ? reportingUrl: tstr,
  ? interactionReportingUrls: { * tstr =&gt; tstr }
}

</pre><a href="#section-2.3.3-2" class="pilcrow">¶</a>
</div>
<p id="section-2.3.3-3">The browser MAY then deserialize the bytestring into a <a href="https://wicg.github.io/turtledove/#server-auction-response">server
auction response structure</a>.<a href="#section-2.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-3">
      <h2 id="name-security-considerations">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-3-1">TODO<a href="#section-3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-4">
      <h2 id="name-iana-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-4-1">This document introduces no additional considerations for IANA.<a href="#section-4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-normative-references">
<section id="section-5">
      <h2 id="name-normative-references">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="ADRENDERID">[ADRENDERID]</dt>
      <dd>
<span class="refTitle">"Protected Audience"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://wicg.github.io/turtledove/#server-auction-previous-win-ad-render-id">https://wicg.github.io/turtledove/#server-auction-previous-win-ad-render-id</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BINARY">[BINARY]</dt>
      <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Binary Representation of HTTP Messages"</span>, <span class="seriesInfo">RFC 9292</span>, <span class="seriesInfo">DOI 10.17487/RFC9292</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9292">https://www.rfc-editor.org/rfc/rfc9292</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CBOR">[CBOR]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CDDL">[CDDL]</dt>
      <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HPKE">[HPKE]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ISO4217">[ISO4217]</dt>
      <dd>
<span class="refTitle">"ISO 4217 Currency codes"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://www.iso.org/iso-4217-currency-codes.html">https://www.iso.org/iso-4217-currency-codes.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="JSON">[JSON]</dt>
      <dd>
<span class="refAuthor">Bray, T., Ed.</span>, <span class="refTitle">"The JavaScript Object Notation (JSON) Data Interchange Format"</span>, <span class="seriesInfo">STD 90</span>, <span class="seriesInfo">RFC 8259</span>, <span class="seriesInfo">DOI 10.17487/RFC8259</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OHTTP">[OHTTP]</dt>
      <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="seriesInfo">RFC 9458</span>, <span class="seriesInfo">DOI 10.17487/RFC9458</span>, <time datetime="2024-01" class="refDate">January 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9458">https://www.rfc-editor.org/rfc/rfc9458</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ORIGIN">[ORIGIN]</dt>
      <dd>
<span class="refTitle">"HTML Living Standard"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin">https://html.spec.whatwg.org/multipage/webappapis.html#concept-settings-object-origin</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1952">[RFC1952]</dt>
      <dd>
<span class="refAuthor">Deutsch, P.</span>, <span class="refTitle">"GZIP file format specification version 4.3"</span>, <span class="seriesInfo">RFC 1952</span>, <span class="seriesInfo">DOI 10.17487/RFC1952</span>, <time datetime="1996-05" class="refDate">May 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1952">https://www.rfc-editor.org/rfc/rfc1952</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7932">[RFC7932]</dt>
      <dd>
<span class="refAuthor">Alakuijala, J.</span> and <span class="refAuthor">Z. Szabadka</span>, <span class="refTitle">"Brotli Compressed Data Format"</span>, <span class="seriesInfo">RFC 7932</span>, <span class="seriesInfo">DOI 10.17487/RFC7932</span>, <time datetime="2016-07" class="refDate">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7932">https://www.rfc-editor.org/rfc/rfc7932</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9562">[RFC9562]</dt>
      <dd>
<span class="refAuthor">Davis, K.</span>, <span class="refAuthor">Peabody, B.</span>, and <span class="refAuthor">P. Leach</span>, <span class="refTitle">"Universally Unique IDentifiers (UUIDs)"</span>, <span class="seriesInfo">RFC 9562</span>, <span class="seriesInfo">DOI 10.17487/RFC9562</span>, <time datetime="2024-05" class="refDate">May 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9562">https://www.rfc-editor.org/rfc/rfc9562</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SHA-256">[SHA-256]</dt>
      <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)"</span>, <span class="seriesInfo">RFC 6234</span>, <span class="seriesInfo">DOI 10.17487/RFC6234</span>, <time datetime="2011-05" class="refDate">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6234">https://www.rfc-editor.org/rfc/rfc6234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="URL">[URL]</dt>
    <dd>
<span class="refTitle">"URL Living Standard"</span>, <time datetime="2024" class="refDate">2024</time>, <span>&lt;<a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Daniel Kocoj</span></div>
<div dir="auto" class="left"><span class="org">Google</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dankocoj@google.com" class="email">dankocoj@google.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Benjamin "Russ" Hamilton</span></div>
<div dir="auto" class="left"><span class="org">Google</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:behamilton@google.com" class="email">behamilton@google.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
